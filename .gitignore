import logging
import openai
from aiogram import Bot, Dispatcher, executor, types
import os

TOKEN = os.getenv("BOT_TOKEN")
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

openai.api_key = OPENAI_API_KEY

logging.basicConfig(level=logging.INFO)

bot = Bot(token=TOKEN)
dp = Dispatcher(bot)


@dp.message_handler(commands=['start'])
async def start(message: types.Message):
    await message.answer(
        "üëã –ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî AI Art Bot.\n"
        "–û—Ç–ø—Ä–∞–≤—å –º–Ω–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏, –∏ —è —Å–æ–∑–¥–∞–º –¥–ª—è —Ç–µ–±—è –∞—Ä—Ç.\n\n"
        "–ù–∞–ø—Ä–∏–º–µ—Ä:\n"
        "‚Ä¢ –¥–µ–≤—É—à–∫–∞ –≤ –∞–Ω–∏–º–µ —Å—Ç–∏–ª–µ\n"
        "‚Ä¢ —ç–ø–∏—á–µ—Å–∫–∏–π –≤–æ–∏–Ω –≤ –æ–≥–Ω–µ\n"
        "‚Ä¢ –∫–æ—Å–º–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ–¥ –≤ –±—É–¥—É—â–µ–º"
    )


@dp.message_handler()
async def generate(message: types.Message):
    prompt = message.text

    wait_msg = await message.answer("üé® –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É, –ø–æ–¥–æ–∂–¥–∏ 5‚Äì10 —Å–µ–∫—É–Ω–¥...")

    try:
        response = openai.images.generate(
            model="gpt-image-1",
            prompt=prompt,
            size="1024x1024"
        )

        image_url = response.data[0].url

        await bot.send_photo(chat_id=message.chat.id, photo=image_url)
        await wait_msg.delete()

    except Exception as e:
        await wait_msg.edit_text("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ.")
        print(e)


if __name__ == "__main__":
    executor.start_polling(dp)
